# lab2D

完成lab2C的状态持久化功能后，我们来看日志压缩的部分

前面提到，我们的raft server对应的是一个kv存储引擎，形成共识的是发给每个服务器的命令日志以及顺序。但是随着时间的推移，日志积攒太多容易超出磁盘空间限制。存放kv引擎的状态要比存放日志本身要节省很多空间。因此实验框架要求我们实现日志压缩快照功能。如果定期对日志做快照(snapshot)，针对某个日志条目做了快照以后，该条目之前的日志都可以被删除，因为我们已经得到kv状态了。论文中还提到一个问题，如果leader已经做了快照删掉一些日志，而follower差的太远，需要被同步的日志已经被删除了，这时我们可以使用一个InstallSnapshot RPC来应对这个问题。leader通过这个rpc来发送快照给follower，使得它们可以同步状态。